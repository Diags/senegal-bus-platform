apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: bus-senegal-prod

resources:
  # Backend
  - backend/deployment.yaml
  - backend/service.yaml
  - backend/ingress.yaml
  
  # Frontend
  - frontend/deployment.yaml
  - frontend/service.yaml
  - frontend/ingress.yaml
  
  # Database
  - postgres/statefulset.yaml
  - postgres/service.yaml
  
  # Authentication
  - keycloak/deployment.yaml
  - keycloak/service.yaml
  - keycloak/ingress.yaml

commonLabels:
  app.kubernetes.io/part-of: bus-senegal-platform
  app.kubernetes.io/managed-by: argocd

configMapGenerator:
  - name: app-config
    literals:
      - APP_ENV=production
      - LOG_LEVEL=INFO
  
  - name: keycloak-realm-config
    files:
      - keycloak/realm-export.json

secretGenerator:
  - name: postgres-secret
    literals:
      - username=bus_senegal_user
      - password=CHANGEME_POSTGRES_PASSWORD
      - jdbc-url=jdbc:postgresql://postgres-svc:5432/bus_senegal_prod
  
  - name: keycloak-secret
    literals:
      - admin-password=CHANGEME_KEYCLOAK_ADMIN_PASSWORD
      - client-secret=CHANGEME_KEYCLOAK_CLIENT_SECRET
  
  - name: nextauth-secret
    literals:
      - secret=CHANGEME_NEXTAUTH_SECRET

generatorOptions:
  disableNameSuffixHash: true

